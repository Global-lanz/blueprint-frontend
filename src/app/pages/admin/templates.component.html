<div class="bp-page">
  <div class="bp-container">
    <div class="bp-page-header">
      <h1>Gerenciar Templates de Projeto</h1>
      <p class="bp-text-muted">Crie e gerencie templates que os clientes usar√£o para criar seus projetos</p>
    </div>
    
    <div class="bp-flex bp-gap-lg bp-mb-lg">
      <button 
        class="bp-btn bp-btn-primary" 
        (click)="showCreateForm = !showCreateForm"
      >
        {{ showCreateForm ? "‚úï Cancelar" : "+ Criar Novo Template" }}
      </button>
    </div>

    <!-- Formul√°rio de Cria√ß√£o -->
    <div class="bp-card bp-mb-2xl" *ngIf="showCreateForm">
      <div class="bp-card-header">
        <h3 class="bp-card-title">Novo Template de Projeto</h3>
      </div>
      <div class="bp-card-body">
        <form (ngSubmit)="createTemplate()">
          <!-- Informa√ß√µes B√°sicas -->
          <div class="bp-form-group">
            <label class="bp-label">Nome do Template *</label>
            <input 
              type="text" 
              class="bp-input" 
              [(ngModel)]="templateForm.name"
              name="name"
              placeholder="Ex: Desenvolvimento de E-commerce"
              required
            />
          </div>

          <div class="bp-grid bp-grid-2 bp-gap-md">
            <div class="bp-form-group">
              <label class="bp-label">Vers√£o *</label>
              <input 
                type="text" 
                class="bp-input" 
                [(ngModel)]="templateForm.version"
                name="version"
                placeholder="1.0"
                required
              />
            </div>
          </div>

          <div class="bp-form-group">
            <label class="bp-label">Descri√ß√£o</label>
            <textarea 
              class="bp-input" 
              [(ngModel)]="templateForm.description"
              name="description"
              rows="3"
              placeholder="Descreva o objetivo deste template..."
            ></textarea>
          </div>

          <!-- Tarefas -->
          <div class="bp-mb-lg">
            <div class="bp-flex bp-justify-between bp-items-center bp-mb-md">
              <h4>Tarefas do Projeto</h4>
              <button 
                type="button"
                class="bp-btn bp-btn-sm bp-btn-secondary" 
                (click)="addTask()"
              >
                + Adicionar Tarefa
              </button>
            </div>

            <div *ngFor="let task of templateForm.tasks; let i = index" class="bp-card bp-mb-md">
              <div class="bp-card-body">
                <div class="bp-flex bp-justify-between bp-items-start bp-mb-md">
                  <h5>Tarefa {{ i + 1 }}</h5>
                  <button 
                    type="button"
                    class="bp-btn bp-btn-sm bp-btn-danger" 
                    (click)="removeTask(i)"
                  >
                    ‚úï
                  </button>
                </div>

                <div class="bp-form-group">
                  <label class="bp-label">T√≠tulo da Tarefa *</label>
                  <input 
                    type="text" 
                    class="bp-input" 
                    [(ngModel)]="task.title"
                    [name]="'task-title-' + i"
                    placeholder="Ex: Configurar ambiente de desenvolvimento"
                    required
                  />
                </div>

                <div class="bp-form-group">
                  <label class="bp-label">Descri√ß√£o *</label>
                  <textarea 
                    class="bp-input" 
                    [(ngModel)]="task.description"
                    [name]="'task-desc-' + i"
                    rows="2"
                    placeholder="Descreva o que deve ser feito nesta tarefa..."
                    required
                  ></textarea>
                </div>

                <!-- Subtarefas -->
                <div class="bp-mt-md">
                  <div class="bp-flex bp-justify-between bp-items-center bp-mb-sm">
                    <label class="bp-label">Subtarefas</label>
                    <button 
                      type="button"
                      class="bp-btn bp-btn-sm bp-btn-secondary" 
                      (click)="addSubtask(i)"
                    >
                      + Adicionar Subtarefa
                    </button>
                  </div>

                  <div *ngFor="let subtask of task.subtasks; let j = index" class="bp-flex bp-gap-sm bp-mb-sm">
                    <input 
                      type="text" 
                      class="bp-input" 
                      [(ngModel)]="subtask.description"
                      [name]="'subtask-' + i + '-' + j"
                      placeholder="Ex: Instalar Node.js e npm"
                    />
                    <button 
                      type="button"
                      class="bp-btn bp-btn-sm bp-btn-danger" 
                      (click)="removeSubtask(i, j)"
                    >
                      ‚úï
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="bp-flex bp-gap-md">
            <button 
              type="submit" 
              class="bp-btn bp-btn-primary"
              [disabled]="saving()"
            >
              {{ saving() ? "Salvando..." : "üíæ Salvar" }}
            </button>
            <button 
              type="button"
              class="bp-btn bp-btn-secondary" 
              (click)="resetForm()"
            >
              Limpar
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Lista de Templates -->
    <div class="bp-card">
      <div class="bp-card-header">
        <h3 class="bp-card-title">Templates Existentes</h3>
      </div>
      <div class="bp-card-body">
        <div *ngIf="templates().length === 0" class="bp-text-center bp-text-muted" style="padding: 2rem;">
          <p>Nenhum template criado ainda.</p>
        </div>
        <div class="bp-grid bp-grid-2 bp-gap-md" *ngIf="templates().length > 0">
          <div *ngFor="let t of templates()" class="bp-card">
            <div class="bp-card-header">
              <div class="bp-flex bp-justify-between bp-items-start">
                <div>
                  <h4 style="margin: 0;">{{ t.name }}</h4>
                  <span class="bp-badge bp-badge-primary bp-mt-sm">vers√£o {{ t.version }}</span>
                </div>
              </div>
            </div>
            <div class="bp-card-body">
              <p class="bp-text-muted">{{ t.description || "Sem descri√ß√£o" }}</p>
            </div>
            <div class="bp-card-footer">
              <div class="bp-flex bp-gap-sm">
                <button class="bp-btn bp-btn-sm bp-btn-secondary" (click)="viewTemplate(t.id)">
                  Ver Detalhes
                </button>
                <button class="bp-btn bp-btn-sm bp-btn-primary" (click)="editTemplate(t.id)">
                  ‚úèÔ∏è Editar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
